<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Pathtracer | You R. Name</title> <meta name="author" content="You R. Name"> <meta name="description" content="CS 184 - Computer Graphics and Imaging"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://i-geng.github.io/projects/pathtracer/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">You </span>R. Name</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/projects/">projects</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Pathtracer</h1> <p class="post-description">CS 184 - Computer Graphics and Imaging</p> </header> <article> <p>In this project:</p> <ul> <li>Raytracing to produce realistic renders of scenes with point or area lights and Lambertian surfaces.</li> <li>Optimization with bounding volume hierarchies and adaptive sampling.</li> </ul> <h3 id="part-1-ray-generation-and-scene-intersection">Part 1: Ray Generation and Scene Intersection.</h3> <p>To generate a camera ray, I first calculate the coordinates of the lower left corner of the virtual camera sensor, as well as the width and height of the sensor rectangle. Then, I can convert from the given normalized image space coordinates \((x, y)\) to the coordinates \((xCamera, yCamera)\) in camera-space using scale proportions. I use the camera’s position and the camera-to-world rotation matrix to transform the ray’s origin and direction to world-space. After normalizing the ray’s direction vector, I return a new ray with the world-space origin and direction, with the minimum and maximum \(t\) values set to <em>nClip</em> and <em>iClip</em>.</p> <p>To raytrace a single pixel in the rendering pipeline, I generate <em>num_samples</em> camera rays and use Monte Carlo estimation to estimate the integral of radiance over the given pixel. I sample from a uniform distribution over a unit square and add the random sample to the bottom left corner of the pixel \((x, y)\) to get a random point inside the pixel. I generate the camera ray corresponding to this random point and add its radiance contribution to my Monte Carlo estimator. After all <em>num_samples</em> samples, I update the pixel’s value in the sample buffer.</p> <p>To test for intersection of a ray with a primitive, I substitute the ray equation \(O + td\) into the implicit formula of the geometric object (which could be a triangle or a sphere) and solve for the value of \(t\). For my triangle intersection algorithm, I use the Möller-Trumbore Algorithm to optimize solving for the intersection point. If the computed value of \(t\) lies within the ray’s range of \([min\_t, max\_t]\) and each coordinate-value of the intersection point’s barycentric coordinates is in the range \([0, 1]\), then the ray intersects the triangle. In the case of intersection, I update the <em>Intersection</em> data object accordingly.</p> <p>Images with normal shading for a few small .dae files.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part1_CBempty-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part1_CBempty-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part1_CBempty-1400.webp"></source> <img src="/assets/img/pathtracer/part1_CBempty.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">CBempty.dae</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part1_CBgems-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part1_CBgems-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part1_CBgems-1400.webp"></source> <img src="/assets/img/pathtracer/part1_CBgems.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">CBgems.dae</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part1_CBspheres_lambertian-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part1_CBspheres_lambertian-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part1_CBspheres_lambertian-1400.webp"></source> <img src="/assets/img/pathtracer/part1_CBspheres_lambertian.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">CBspheres_lambertian.dae</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part1_cow-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part1_cow-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part1_cow-1400.webp"></source> <img src="/assets/img/pathtracer/part1_cow.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">cow.dae</figcaption> </figure> </div> </div> <h3 id="part-2-bounding-volume-hierarchies">Part 2: Bounding Volume Hierarchies</h3> <p>For my BVH construction algorithm, I first compute the bounding box of the given list of primitives and initialize a BVHNode with the bounding box. If the number of objects in the node is less than or equal to the <em>max_leaf_size</em>, the node is a leaf and I return it. Otherwise, I recursively build the left and right children.</p> <p>The heuristic I use for the splitting point is the average of centroids along the longest axis of the bounding box. I find the longest axis by examining the bounding box’s <em>extent</em> member. Then, I sort the primitives according to which side of the splitting point they fall on, by iterating through the primitives and swapping elements by keeping track of a pointer to the end of the left child’s elements. If all the elements are sorted into one child, I decide that the node is a leaf node and terminate early.</p> <p>Images with normal shading for a few large .dae files, rendered with BVH acceleration.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part2_CBdragon-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part2_CBdragon-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part2_CBdragon-1400.webp"></source> <img src="/assets/img/pathtracer/part2_CBdragon.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">CBdragon.dae</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part2_CBlucy-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part2_CBlucy-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part2_CBlucy-1400.webp"></source> <img src="/assets/img/pathtracer/part2_CBlucy.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">CBlucy.dae</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part2_beast-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part2_beast-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part2_beast-1400.webp"></source> <img src="/assets/img/pathtracer/part2_beast.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">beast.dae</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part2_maxplanck-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part2_maxplanck-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part2_maxplanck-1400.webp"></source> <img src="/assets/img/pathtracer/part2_maxplanck.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">maxplanck.dae</figcaption> </figure> </div> </div> <div class="row justify-content-center"> <div class="col-sm mt-3 mt-md-0 justify-content-center"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part2_walle-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part2_walle-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part2_walle-1400.webp"></source> <img src="/assets/img/pathtracer/part2_walle.png" class="mx-auto img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">wall-e.dae</figcaption> </figure> </div> </div> <p>For cow.dae, BVH acceleration yields a speed-up factor of approximately 300, while for more complex scenes like beast.dae and maxplanck.dae, BVH acceleration is over 1000 times faster. For a complex geometric scene like CBlucy.dae, BVH acceleration can complete a render in just 0.0732 sec (I did not attempt to render CBlucy.dae without acceleration).</p> <h3 id="part-3-direct-illumination">Part 3: Direct Illumination</h3> <p>For uniform hemisphere lighting, I take <em>num_samples</em> number of samples (equal to the number of lights times the number of samples per area light) over the unit hemisphere. Then, I trace a ray from point <em>p</em> in the sampled direction and check if this new ray intersects another object. I get the emission value of the surface at the new point of intersection, which is non-zero if the new ray intersects a light source. Then, using the reflectance value the estimate of incoming light, I can use the reflection equation to calculate the amount of outgoing light with a Monte Carlo estimator. After adding up the contributions from all the sampled directions, I normalize by dividing by the number of samples and dividing by the value of the probability density function, which is \(1 / 2\pi\) since we sample over the unit hemisphere.</p> <p>Images rendered with both implementations of the direct lighting function.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBspheres_lambertian_H_64_32-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBspheres_lambertian_H_64_32-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBspheres_lambertian_H_64_32-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBspheres_lambertian_H_64_32.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBspheres_lambertian_64_32-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBspheres_lambertian_64_32-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBspheres_lambertian_64_32-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBspheres_lambertian_64_32.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_H_64_32-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_H_64_32-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_H_64_32-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_H_64_32.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Uniform Hemisphere Sampling</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_64_32-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_64_32-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_64_32-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_64_32.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Importance Light Sampling</figcaption> </figure> </div> </div> <p>Here is CBbunny.dae rendered with 1, 4, 16, and 64 light rays and with 1 sample per pixel using importance light sampling. As the number of samples per area light increases, the soft shadows become less noisy. At 1 or 4 light rays, the shadows under the bunny look very spotty. At 16 light rays, the shadows looks less like individual dots.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_1-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_1_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">1 Light Ray</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_4-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_4-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_4-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_1_4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">4 Light Rays</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_16-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_16-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_16-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_1_16.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">16 Light Rays</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_64-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_64-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_64-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_1_64.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">64 Light Rays</figcaption> </figure> </div> </div> <p>Uniform hemisphere sampling is somewhat slower than importance light sampling. For example, to render the Cornel Box bunny with 64 camera rays per pixel and 32 samples per area light, uniform hemisphere sampling takes about 98 seconds, while importance sampling takes 84 seconds. However, importance sampling greatly reduces the noise levels when compared to uniform hemisphere sampling at the same sample rates.</p> <p>For example, when rendering the Cornel Box bunny with a very low sampling rate (1 camera ray per pixel and 1 sample per area light), the image created with uniform hemisphere sampling is so noisy that the shape of the model is barely visible, and the scene is barely lit. In contrast, the image created with importance sampling is much clearer.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_H_1_1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_H_1_1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_H_1_1-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_H_1_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Uniform Hemisphere Sampling</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part3_CBbunny_1_1-1400.webp"></source> <img src="/assets/img/pathtracer/part3_CBbunny_1_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Importance Light Sampling</figcaption> </figure> </div> </div> <h3 id="part-4-global-illumination">Part 4: Global Illumination</h3> <p>For indirect lighting, I first add the direct illumination from one bounce radiance to <em>L_out</em>. Then, I sample one direction over the unit hemisphere in object space. I cast a ray from the given point <em>hit_p</em> in the sampled direction. Before checking for any intersections, I compute the continuation probability, the \(cpdf\). The \(cpdf = 1\) if this is the first bounce and the maximum ray depth is greater than 1; we should trace at least one indirect bounce regardless of Russian roulette. Otherwise, if the current ray depth is greater than 1 but this is not the first bounce, we terminate with probability 0.3, so the \(cpdf = 0.7\). If we do not terminate, I check for an intersection between the new sample ray and another scene object. If there is an intersection, I recurse with the new ray and new intersection point, then multiply by the reflectance and a cosine term, and normalize by both the \(pdf\) and the \(cpdf\). I add the contributed radiance to <em>L_out</em> and return <em>L_out</em>.</p> <p>Some images rendered with global illumination using 1024 samples per pixels, 32 light rays per pixel, and maximum ray depth of 5.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CB_spheres_lambertian_1024_32_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CB_spheres_lambertian_1024_32_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CB_spheres_lambertian_1024_32_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CB_spheres_lambertian_1024_32_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">CB_spheres_lambertian.dae</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_banana_1024_32_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_banana_1024_32_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_banana_1024_32_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_banana_1024_32_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">banana.dae</figcaption> </figure> </div> </div> <p>The bunny, rendered with only direct illumination and then only indirect illumination, using 1024 samples per pixel.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_only_direct_1024_32_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_only_direct_1024_32_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_only_direct_1024_32_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_only_direct_1024_32_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Only direct illumination</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_only_indirect_1024_32_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_only_indirect_1024_32_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_only_indirect_1024_32_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_only_indirect_1024_32_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Only indirect illumination</figcaption> </figure> </div> </div> <p>Direct illumination only includes zero-bounce lighting and one-bounce lighting, so we see the rectangular area light on the ceiling of the Cornell Box and the first bounce of light from the bunny/walls to the camera. The shadows are completely black and the ceiling is not illuminated.</p> <p>Only indirect illumination includes two or more bounces of light from the area light to the camera. The underside of the bunny and the ceiling of the Cornell Box are illuminated. The image is not very bright overall.</p> <p>For CBbunny.dae, here are rendered views with max ray depth set to 0, 1, 2, 3, and 100. I used 1024 samples per pixel and 32 light rays per pixel.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_0-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_0-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_0-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_1024_32_0.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">max ray depth = 0</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_1-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_1024_32_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">max ray depth = 1</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_2-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_1024_32_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">max ray depth = 2</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_3-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_3-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_3-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_1024_32_3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">max ray depth = 3</figcaption> </figure> </div> </div> <div class="row justify-content-center"> <div class="col-sm mt-3 mt-md-0 justify-content-center"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_100-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_100-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_32_100-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_1024_32_100.png" class="mx-auto img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">max ray depth = 100</figcaption> </figure> </div> </div> <p>A max ray depth of 0 corresponds to only zero-bounce lighting, so the only thing we see is the direct light from the area light. A max ray depth of 1 corresponds to only direct illumination. For any max ray depth greater than 1, I always calculate at least one additional indirect bounce. As max ray depth increases, the scene also gets slightly brighter.</p> <p>Here is CBbunny.dae rendered with various sample-per-pixel rates: 1, 2, 4, 8, 16, 64, and 1024. I used 4 light rays and max ray depth of 5.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_1_4_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_1_4_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_1_4_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_1_4_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">1 sample per pixel</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_2_4_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_2_4_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_2_4_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_2_4_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">2 samples per pixel</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_4_4_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_4_4_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_4_4_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_4_4_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">4 samples per pixel</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_8_4_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_8_4_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_8_4_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_8_4_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">8 samples per pixel</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_16_4_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_16_4_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_16_4_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_16_4_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">16 samples per pixel</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_64_4_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_64_4_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_64_4_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_64_4_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">64 samples per pixel</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0 justify-content-center"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_4_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_4_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part4_CBbunny_1024_4_5-1400.webp"></source> <img src="/assets/img/pathtracer/part4_CBbunny_1024_4_5.png" class="mx-auto img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">1024 samples per pixel</figcaption> </figure> </div> </div> <p>As the number of samples per pixel, the scene becomes less noisy. At just 1 sample per pixel, the image is very spotty, and the shadows on the bunny are not uniform. At 1024 samples per pixel, the image is much clearer, and the bunny’s shading is much smoother.</p> <h3 id="part-5-adaptive-sampling">Part 5: Adaptive Sampling</h3> <p>Adaptive sampling is a technique used to reduce rendering times by taking fewer samples for pixels that converge more quickly, instead of sampling every single pixel a fixed number of times.</p> <p>Each time I sample a pixel, I compute the illuminance from the radiance and track running totals for the sum of illuminances and the sum of squared illuminances. Every batch of samples, I calculate the mean and standard deviation of the illuminance samples so far. Then, I calculate the value of \(I\) and check if it is less than or equal to the max tolerance times the mean. If so, then this pixel has converged early. I stop sampling the pixel and update the sample buffer with the estimated radiance and sample count buffer with the total number of samples (less than the maximum possible number of samples).</p> <p>Here are CBspheres_lambertian.dae and CBbunny.dae rendered with 2048 samples per pixel, 1 light ray, and max ray depth of 5. In the sampling rate image, red indicates that the pixel’s value did not converge early, while blue indicates that the pixel’s value converged early at a low sampling rate.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5-1400.webp"></source> <img src="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Rendered image</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5_rate-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5_rate-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5_rate-1400.webp"></source> <img src="/assets/img/pathtracer/part5_CBspheres_lambertian_2048_1_5_rate.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Sample rate image</figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part5_CBbunny_2048_1_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part5_CBbunny_2048_1_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part5_CBbunny_2048_1_5-1400.webp"></source> <img src="/assets/img/pathtracer/part5_CBbunny_2048_1_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Rendered image</figcaption> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pathtracer/part5_CBbunny_2048_1_5_rate-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pathtracer/part5_CBbunny_2048_1_5_rate-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pathtracer/part5_CBbunny_2048_1_5_rate-1400.webp"></source> <img src="/assets/img/pathtracer/part5_CBbunny_2048_1_5_rate.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Sample rate image</figcaption> </figure> </div> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 You R. Name. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>